---
title: スレッドおよびスレッド処理
ms.date: 11/08/2018
ms.technology: dotnet-standard
helpviewer_keywords:
- multiple threads
- threading [.NET]
- threading [.NET], multiple threads
ms.assetid: 5baac3aa-e603-4fa6-9f89-0f2c1084e6b1
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 095bd92921c9cd54d3a7d97ed07b35526b85c57f
ms.sourcegitcommit: 7f7664837d35320a0bad3f7e4ecd68d6624633b2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/30/2018
ms.locfileid: "52672307"
---
# <a name="threads-and-threading"></a><span data-ttu-id="0301e-102">スレッドおよびスレッド処理</span><span class="sxs-lookup"><span data-stu-id="0301e-102">Threads and threading</span></span>

<span data-ttu-id="0301e-103">マルチスレッドによりアプリケーションの応答性が向上し、さらにアプリケーションがマルチプロセッサやマルチコア システム上で実行されている場合にはそのスループットも向上します。</span><span class="sxs-lookup"><span data-stu-id="0301e-103">Multithreading allows you to increase the responsiveness of your application and, if your application runs on a multiprocessor or multi-core system, increase its throughput.</span></span>

## <a name="processes-and-threads"></a><span data-ttu-id="0301e-104">プロセスおよびスレッド</span><span class="sxs-lookup"><span data-stu-id="0301e-104">Processes and threads</span></span>

<span data-ttu-id="0301e-105">*プロセス*は、実行中のプログラムです。</span><span class="sxs-lookup"><span data-stu-id="0301e-105">A *process* is an executing program.</span></span> <span data-ttu-id="0301e-106">オペレーティング システムはプロセスを使用して実行中のアプリケーションを区別します。</span><span class="sxs-lookup"><span data-stu-id="0301e-106">An operating system uses processes to separate the applications that are being executed.</span></span> <span data-ttu-id="0301e-107">*スレッド*は、オペレーティング システムがプロセッサ時間を割り当てる基本単位です。</span><span class="sxs-lookup"><span data-stu-id="0301e-107">A *thread* is the basic unit to which an operating system allocates processor time.</span></span> <span data-ttu-id="0301e-108">各スレッドには[スケジューリングの優先順位](scheduling-threads.md)があり、スレッドの実行が一時停止されるときにシステムがスレッド コンテキストを保存するために使用する構造体のセットが保持されています。</span><span class="sxs-lookup"><span data-stu-id="0301e-108">Each thread has a [scheduling priority](scheduling-threads.md) and maintains a set of structures the system uses to save the thread context when the thread's execution is paused.</span></span> <span data-ttu-id="0301e-109">スレッド コンテキストには、スレッドがシームレスに実行を再開するために必要なすべての情報 (スレッドの CPU レジスタとスタックのセットなど) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="0301e-109">The thread context includes all the information the thread needs to seamlessly resume execution, including the thread's set of CPU registers and stack.</span></span> <span data-ttu-id="0301e-110">複数のスレッドは、プロセスのコンテキストで実行できます。</span><span class="sxs-lookup"><span data-stu-id="0301e-110">Multiple threads can run in the context of a process.</span></span> <span data-ttu-id="0301e-111">プロセスのすべてのスレッドで、仮想アドレス空間が共有されます。</span><span class="sxs-lookup"><span data-stu-id="0301e-111">All threads of a process share its virtual address space.</span></span> <span data-ttu-id="0301e-112">スレッドは、別のスレッドによって実行されている部分を含む、プログラム コードのすべての部分を実行できます。</span><span class="sxs-lookup"><span data-stu-id="0301e-112">A thread can execute any part of the program code, including parts currently being executed by another thread.</span></span>

> [!NOTE]
> <span data-ttu-id="0301e-113">.NET Framework では、*アプリケーション ドメイン*の使用によりプロセス内でアプリケーションを分離する方法が提供されます。</span><span class="sxs-lookup"><span data-stu-id="0301e-113">The .NET Framework provides a way to isolate applications within a process with the use of *application domains*.</span></span> <span data-ttu-id="0301e-114">(アプリケーション ドメインは .NET Core で使用できません。)詳細については、「[アプリケーション ドメイン](../../framework/app-domains/application-domains.md)」の記事の「[アプリケーション ドメインとスレッド](../../framework/app-domains/application-domains.md#application-domains-and-threads)」のセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="0301e-114">(Application domains are not available on .NET Core.) For more information, see the [Application domains and threads](../../framework/app-domains/application-domains.md#application-domains-and-threads) section of the [Application domains](../../framework/app-domains/application-domains.md) article.</span></span>

<span data-ttu-id="0301e-115">既定では、.NET プログラムは、1 つのスレッド (よく*プライマリ* スレッドと呼ばれます) で開始します。</span><span class="sxs-lookup"><span data-stu-id="0301e-115">By default, a .NET program is started with a single thread, often called the *primary* thread.</span></span> <span data-ttu-id="0301e-116">ただし、コードを並列実行したり、プライマリ スレッドと同時に実行したりするための追加のスレッドを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="0301e-116">However, it can create additional threads to execute code in parallel or concurrently with the primary thread.</span></span> <span data-ttu-id="0301e-117">このようなスレッドは、よく*ワーカー* スレッドと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="0301e-117">These threads are often called *worker* threads.</span></span>

## <a name="when-to-use-multiple-threads"></a><span data-ttu-id="0301e-118">複数のスレッドを使用する場合</span><span class="sxs-lookup"><span data-stu-id="0301e-118">When to use multiple threads</span></span>

<span data-ttu-id="0301e-119">複数のスレッドを使用すると、アプリケーションの応答性が向上し、さらにマルチプロセッサやマルチコア システムの利点を活用してアプリケーションのそのスループットも向上します。</span><span class="sxs-lookup"><span data-stu-id="0301e-119">You use multiple threads to increase the responsiveness of your application and to take advantage of a multiprocessor or multi-core system to increase the application's throughput.</span></span>

<span data-ttu-id="0301e-120">プライマリ スレッドがユーザー インターフェイス要素を担い、ユーザーの操作に応答するデスクトップ アプリケーションを考えてください。</span><span class="sxs-lookup"><span data-stu-id="0301e-120">Consider a desktop application, in which the primary thread is responsible for user interface elements and responds to user actions.</span></span> <span data-ttu-id="0301e-121">ワーカー スレッドは、時間のかかる操作を実行する場合に使用します。そうしないと、プライマリ スレッドが一杯になり、ユーザー インターフェイスが応答しなくなります。</span><span class="sxs-lookup"><span data-stu-id="0301e-121">Use worker threads to perform time-consuming operations that, otherwise, would occupy the primary thread and make the user interface non-responsive.</span></span> <span data-ttu-id="0301e-122">ネットワークやデバイスの通信専用のスレッドを使用して、受信したメッセージやイベントへの応答性を高めることもできます。</span><span class="sxs-lookup"><span data-stu-id="0301e-122">You also can use a dedicated thread for network or device communication to be more responsive to incoming messages or events.</span></span>

<span data-ttu-id="0301e-123">並列で実行できる操作をプログラムが実行する場合、そのような操作を別のスレッドで実行し、プログラムをマルチプロセッサやマルチコア システムで実行することで、合計実行時間を短縮することができます。</span><span class="sxs-lookup"><span data-stu-id="0301e-123">If your program performs operations that can be done in parallel, the total execution time can be decreased by performing those operations in separate threads and running the program on a multiprocessor or multi-core system.</span></span> <span data-ttu-id="0301e-124">このようなシステムでは、マルチスレッドを使用すると、応答性とともにスループットも向上する場合があります。</span><span class="sxs-lookup"><span data-stu-id="0301e-124">On such a system, use of multithreading might increase throughput along with the increased responsiveness.</span></span>

## <a name="how-to-use-multithreading-in-net"></a><span data-ttu-id="0301e-125">.NET でのマルチスレッドの使用方法</span><span class="sxs-lookup"><span data-stu-id="0301e-125">How to use multithreading in .NET</span></span>

<span data-ttu-id="0301e-126">.NET Framework 4 より、マルチスレッドを使用するために推奨される方法が、[タスク並列ライブラリ (TPL)](../parallel-programming/task-parallel-library-tpl.md) と [Parallel LINQ (PLINQ)](../parallel-programming/parallel-linq-plinq.md) の使用です。</span><span class="sxs-lookup"><span data-stu-id="0301e-126">Starting with the .NET Framework 4, the recommended way to utilize multithreading is to use [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md) and [Parallel LINQ (PLINQ)](../parallel-programming/parallel-linq-plinq.md).</span></span> <span data-ttu-id="0301e-127">詳細については、[並列プログラミング](../parallel-programming/index.md)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="0301e-127">For more information, see [Parallel programming](../parallel-programming/index.md).</span></span>

<span data-ttu-id="0301e-128">TPL も PLINQ も、<xref:System.Threading.ThreadPool> スレッドに依存しています。</span><span class="sxs-lookup"><span data-stu-id="0301e-128">Both TPL and PLINQ rely on the <xref:System.Threading.ThreadPool> threads.</span></span> <span data-ttu-id="0301e-129"><xref:System.Threading.ThreadPool?displayProperty=nameWithType> クラスから .NET アプリケーションにワーカー スレッドのプールが提供されます。</span><span class="sxs-lookup"><span data-stu-id="0301e-129">The <xref:System.Threading.ThreadPool?displayProperty=nameWithType> class provides a .NET application with a pool of worker threads.</span></span> <span data-ttu-id="0301e-130">スレッド プールのスレッドを使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="0301e-130">You also can use thread pool threads.</span></span> <span data-ttu-id="0301e-131">詳しくは、「[マネージド スレッド プール](the-managed-thread-pool.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0301e-131">For more information, see [The managed thread pool](the-managed-thread-pool.md).</span></span>

<span data-ttu-id="0301e-132">最後に、マネージド スレッドを表す <xref:System.Threading.Thread?displayProperty=nameWithType> クラスを使用することができます。</span><span class="sxs-lookup"><span data-stu-id="0301e-132">At last, you can use the <xref:System.Threading.Thread?displayProperty=nameWithType> class that represents a managed thread.</span></span> <span data-ttu-id="0301e-133">詳細については、「[スレッドの使用とスレッド処理](using-threads-and-threading.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0301e-133">For more information, see [Using threads and threading](using-threads-and-threading.md).</span></span>

<span data-ttu-id="0301e-134">複数のスレッドで、共有リソースにアクセスできる必要があります。</span><span class="sxs-lookup"><span data-stu-id="0301e-134">Multiple threads might need to access a shared resource.</span></span> <span data-ttu-id="0301e-135">リソースを壊れていない状態のまま保持し、競合状態を避けるには、スレッド アクセス権を同期する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0301e-135">To keep the resource in a uncorrupted state and avoid race conditions, you must synchronize the thread access to it.</span></span> <span data-ttu-id="0301e-136">複数のスレッドの相互作用の調整が必要になる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="0301e-136">You also might want to coordinate the interaction of multiple threads.</span></span> <span data-ttu-id="0301e-137">.NET では、共有リソースへのアクセスを同期する場合や、スレッド相互作用を調整する場合に使用できるさまざまな型が提供されます。</span><span class="sxs-lookup"><span data-stu-id="0301e-137">.NET provides a range of types that you can use to synchronize access to a shared resource or coordinate thread interaction.</span></span> <span data-ttu-id="0301e-138">詳細については、「[同期プリミティブの概要](overview-of-synchronization-primitives.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0301e-138">For more information, see [Overview of synchronization primitives](overview-of-synchronization-primitives.md).</span></span>

<span data-ttu-id="0301e-139">スレッドで例外を処理します。</span><span class="sxs-lookup"><span data-stu-id="0301e-139">Do handle exceptions in threads.</span></span> <span data-ttu-id="0301e-140">スレッドで未処理の例外が発生すると、通常はプロセスが終了します。</span><span class="sxs-lookup"><span data-stu-id="0301e-140">Unhandled exceptions in threads generally terminate the process.</span></span> <span data-ttu-id="0301e-141">詳細については、「[マネージド スレッドの例外](exceptions-in-managed-threads.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0301e-141">For more information, see [Exceptions in managed threads](exceptions-in-managed-threads.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="0301e-142">関連項目</span><span class="sxs-lookup"><span data-stu-id="0301e-142">See also</span></span>

- [<span data-ttu-id="0301e-143">スレッド処理オブジェクトと機能</span><span class="sxs-lookup"><span data-stu-id="0301e-143">Threading objects and features</span></span>](threading-objects-and-features.md)
- [<span data-ttu-id="0301e-144">マネージド スレッド処理の実施</span><span class="sxs-lookup"><span data-stu-id="0301e-144">Managed threading best practices</span></span>](managed-threading-best-practices.md)
- [<span data-ttu-id="0301e-145">.NET での並列処理、コンカレンシー、および非同期プログラミング</span><span class="sxs-lookup"><span data-stu-id="0301e-145">Parallel Processing, Concurrency, and Async Programming in .NET</span></span>](../parallel-processing-and-concurrency.md)
- [<span data-ttu-id="0301e-146">プロセスとスレッドについて</span><span class="sxs-lookup"><span data-stu-id="0301e-146">About Processes and Threads</span></span>](/windows/desktop/procthread/about-processes-and-threads)