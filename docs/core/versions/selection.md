---
title: .NET Core のバージョンの選択
description: .NET Core がお使いのブログラムのランタイム バージョンを探し、選択するしくみについて説明します。
author: billwagner
ms.author: wiwagn
ms.date: 06/27/2018
ms.openlocfilehash: 28a76cc17346c40517a21e8dc902bd6c2a84597f
ms.sourcegitcommit: fb78d8abbdb87144a3872cf154930157090dd933
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2018
ms.locfileid: "47233205"
---
# <a name="net-core-version-selection"></a>.NET Core のバージョンの選択

[!INCLUDE [topic-appliesto-net-core-2plus](../../../includes/topic-appliesto-net-core-2plus.md)]

この記事では、.NET Core ツール、SDK、ランタイムによって使用されるバージョン選択ポリシーについて説明します。 これらのポリシーでは、指定バージョンを使用してアプリケーションを実行することと、開発者のコンピューターとエンド ユーザーのコンピューターの両方を簡単にアップグレードすることを両立させています。 これらのポリシーによって次のアクションが実行されます。

- セキュリティと信頼性の更新プログラムを含め、.NET Core を簡単かつ効率的に展開する。
- ターゲット ランタイムとは関係なく、最新のツールとコマンドを使用する。

バージョンが次のように選択されます。

- SDK コマンドを実行すると、[SDK はインストールされている最新のバージョンを使用します](#the-sdk-uses-the-latest-installed-version)。
- アセンブリをビルドすると、[ターゲット フレームワーク モニカーによってビルド時間 API が定義されます](#target-framework-monikers-define-build-time-apis)。
- .NET Core アプリケーションを実行すると、[ターゲット フレームワークに依存するアプリがロールフォワードされます](#framework-dependent-apps-roll-forward)。
- 自己完結型アプリケーションを公開するとき、[自己完結型の展開には選択されたランタイムが含まれます](#self-contained-deployments-include-the-selected-runtime)。

このドキュメントの残りの部分では、これら 4 つのシナリオについて説明します。

## <a name="the-sdk-uses-the-latest-installed-version"></a>SDK はインストールされている最新バージョンを使用する

SDK コマンドには `dotnet new` または `dotnet run` が含まれています。 `dotnet` CLI の場合、どの dotnet コマンドに対しても SDK バージョンを選択する必要があります。 以下のような場合でも、.NET Core CLI では既定でマシンにインストールされている最新の SDK が使用されます。

* プロジェクトが以前のバージョンをターゲットとしている。
* 最新バージョンがプレビュー バージョンである。

アプリが以前のバージョンの .NET Core ランタイムをターゲットにしている場合でも、SDK の最新の機能と機能改善を利用できます。 すべてのプロジェクトに同じ SDK ツールを使用し、異なるプロジェクトで複数のランタイム バージョンの .NET Core をターゲットにできます。

まれに、以前のバージョンの SDK を使用する必要がある場合があります。 そのバージョンは [*global.json* ファイル](../tools/global-json.md)で指定します。 "最新版を使用する" というポリシーは、インストールされている最新版より以前のバージョンの .NET Core SDK を指定するには *global.json* を使用することを意味します。

*global.json* はファイル階層のどこにでも配置できます。 CLI はプロジェクト ディレクトリから上方を検索し、最初の *global.json* を見つけます。 ファイル システム内のその場所によって、特定の *global.json* が適用されるプロジェクトを制御します。 .NET CLI は、現在の作業ディレクトリからパスを上方に移動し、*global.json* ファイルを繰り返し検索します。 見つかった最初の *global.json* ファイルによって、使用されるバージョンが指定されます。 そのバージョンがインストールされている場合、そのバージョンが使用されます。 *global.json* に指定されている SDK が見つからない場合、.NET CLI はインストールされている最新の SDK にロールフォワードします。 ロール フォワードは、*global.json* ファイルが見つからないとき、これは既定の動作と同じになります。

次の例は *global.json* 構文を示しています。

``` json
{
  "sdk": {
    "version": "2.0.0"
  }
}
```

SDK バージョンを選択するためのプロセス:

1. `dotnet` は、現在の作業ディレクトリからパスを上方に逆移動し、*global.json* ファイルを繰り返し検索します。
1. `dotnet` は見つかった最初の *global.json* に指定されている SDK を使用します。
1. *global.json* が見つからない場合、`dotnet` はインストールされている最新の SDK を使用します。

SDK バージョンの選択に関する詳細は、*global.json* に関する記事の「[照合ルール](../tools/global-json.md#matching-rules)」にあります。

## <a name="target-framework-monikers-define-build-time-apis"></a>ターゲット フレームワーク モニカーによりビルド時間 API を定義する

**ターゲット フレームワーク モニカー** (TFM) に定義されている API に対してプロジェクトをビルドします。 [ターゲット フレームワーク](../../standard/frameworks.md)はプロジェクト ファイルで指定します。 次の例のように、プロジェクト ファイルに `TargetFramework` 要素を設定します。

``` xml
<TargetFramework>netcoreapp2.0</TargetFramework>
```

複数の TFM に対してプロジェクトをビルドできます。 複数のターゲット フレームワークを設定することはライブラリで一般的ですが、アプリケーションでも可能です。 `TargetFrameworks` プロパティ (`TargetFramework` の複数形) を指定します。 次の例のように、ターゲット フレームワークはセミコロンで区切られます。

``` xml
<TargetFrameworks>netcoreapp2.0;net47</TargetFrameworks>
```

特定の SDK でサポートされる一連のフレームワークは決まっており、同梱のランタイムのターゲット フレームワークが上限となります。 たとえば、.NET Core 2.0 SDK には .NET Core 2.0 ランタイムが含まれますが、これは `netcoreapp2.0` ターゲット フレームワークの実装です。 .NET Core 2.0 SDK は `netcoreapp1.0`、`netcoreapp1.1`、`netcoreapp2.0` をサポートしますが、`netcoreapp2.1` (以降) はサポートされません。 `netcoreapp2.1` のビルドには、.NET Core 2.1 SDK をインストールします。

.NET Standard ターゲット フレームワークの上限も、SDK に付属するランタイムのターゲット フレームワークになります。 .NET Core 2.0 SDK の上限は `netstandard2.0` になります。

## <a name="framework-dependent-apps-roll-forward"></a>フレームワーク依存のアプリをロールフォワードする

[`dotnet run`](../tools/dotnet-run.md) を使用し、ソースからアプリケーションを実行します。 `dotnet run` はアプリケーションをビルドし、さらに実行します。 `dotnet` 実行可能ファイルは、開発環境においてアプリケーションの**ホスト**になります。

このホストがコンピューターにインストールされている最新版のパッチを選択します。 たとえば、プロジェクト ファイルに `netcoreapp2.0` を指定したとき、`2.0.4` がインストールされている最新の .NET ランタイムであれば、`2.0.4` ランタイムが使用されます。

許容される `2.0.*` バージョンが見つからない場合、新しい `2.*` バージョンが使用されます。 たとえば、`netcoreapp2.0` を指定したとき、`2.1.0` だけがインストールされている場合、アプリケーションは `2.1.0` ランタイムを利用して実行されます。 この動作は "マイナー バージョン ロールフォワード" と呼ばれます。 下位バージョンも考慮されません。 許容されるランタイムがインストールされていないとき、アプリケーションは実行されません。

以下にこの動作を示す使用例をいくつか示します。

- 2.0.4 が必須です。 インストールされているパッチ バージョンのうち、一番上が 2.0.5 です。 2.0.5 が使用されます。
- 2.0.4 が必須です。 2.0.* バージョンはインストールされていません。 インストールされているランタイムのうち、一番上が 1.1.1 です。 エラー メッセージが表示されます。
- 2.0.4 が必須です。 インストールされているバージョンのうち、一番上が 2.0.0 です。 エラー メッセージが表示されます。
- 2.0.4 が必須です。 2.0.* バージョンはインストールされていません。 インストールされている 2.x ランタイム バージョンのうち、一番上が 2.2.2 です。 2.2.2 が使用されます。
- 2.0.4 が必須です。 2.x バージョンはインストールされていません。 3.0.0 (現在のところ、利用できないバージョン) がインストールされています。 エラー メッセージが表示されます。

マイナー バージョン ロールフォワードには、エンド ユーザーに影響を与える可能性がある副作用が 1 つあります。 次のシナリオについて検討してください。

- 2.0.4 が必須です。 2.0.* バージョンはインストールされていません。 2.2.2 がインストールされています。 2.2.2 が使用されます。
- 2.0.5 が後にインストールされます。 後にアプリケーションを起動したとき、2.2.2 ではなく、2.0.5 が使用されます。 必須のマイナー バージョンの最新のパッチが上位のマイナー バージョンより優先されます。
- バイナリ データをシリアル化するなどのシナリオでは特に、2.0.5 と 2.2.2 の動作が異なることがあります。

## <a name="self-contained-deployments-include-the-selected-runtime"></a>自己完結型の展開に選択したランタイムが含まれる

[**自己完結型ディストリビューション**](../deploying/index.md#self-contained-deployments-scd)としてアプリケーションを公開できます。 この手法では、.NET Core のランタイムとライブラリがアプリケーションと共にバンドルされます。 自己完結型の展開には、ランタイム環境に対する依存性がありません。 ランタイム バージョンは実行時ではなく、公開時に選択されます。

公開プロセスでは、特定のランタイム ファミリの最新版パッチが選択されます。 たとえば、`dotnet publish` では、.NET Core 2.0 ランタイム ファミリの最新版パッチが .NET Core 2.0.4 であればそれが選択されます。 ターゲット フレームワーク (インストールされているセキュリティ パッチを含む) がアプリケーションと共にパッケージ化されます。

アプリケーションに指定されている最小バージョンで十分ではない場合、エラーとなります。 `dotnet publish` は (特定の major.minor バージョン ファミリ内の) 最新ランタイム パッチ バージョンにバインドします。 `dotnet publish` は `dotnet run` のロールフォワード セマンティクスをサポートしません。 パッチや自己完結型の展開の詳細については、.NET Core アプリケーション展開の[ランタイム パッチ選択](../deploying/runtime-patch-selection.md)に関する記事を参照してください。

自己完結型の展開では、特定のパッチ バージョンが必要になることがあります。 次の例のように、プロジェクト ファイルで最小ランタイム パッチ バージョンを (上位または下位のバージョンに) オーバーライドできます。

``` xml
<RuntimeFrameworkVersion>2.0.4</RuntimeFrameworkVersion>
```

`RuntimeFrameworkVersion` 要素は既定のバージョン ポリシーをオーバーライドします。 自己完結型の展開の場合、`RuntimeFrameworkVersion` によって*厳密な*ランタイム フレームワーク バージョンが指定されます。 フレームワーク依存アプリケーションの場合、`RuntimeFrameworkVersion` によって*最小限*必要なランタイム フレームワーク バージョンが指定されます。
